{"ast":null,"code":"import _defineProperty from \"/Users/chrisfu/openapi.portal/ui/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport jwt_decode from 'jwt-decode';\nimport { LOGOUT, LOGIN_REQUESTED, LOGIN_REQUEST_SUCCESS, LOGIN_REQUEST_FAILURE } from '../actions/apiActions';\n\nfunction loadUserProfile() {\n  // check if the user has previously logged in. \n  try {\n    var token = localStorage.getItem(\"auth-token\");\n    var user = localStorage.getItem(\"auth-user\");\n    if (token == null || user == null) return null;\n    var decoded = jwt_decode(token);\n    var now = new Date().getTime() / 1000; // Date().getTime() returns\n    // milliseconds.\n    // So divide by 1000 to get\n    // seconds\n\n    if (now > decoded.exp) {\n      return null;\n    } else {\n      return user;\n    }\n  } catch (err) {\n    return null;\n  }\n}\n\nvar initialState = {\n  user: null,\n  isLoading: false,\n  error: null\n};\n\nfunction initializeState() {\n  var user = loadUserProfile();\n\n  if (!user) {\n    return initialState;\n  }\n\n  return Object.assign({}, initialState, {\n    user: user\n  });\n}\n\nexport default (function () {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initializeState();\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case LOGIN_REQUESTED:\n      return _objectSpread({}, state, {\n        user: null,\n        isLoading: true,\n        error: null\n      });\n\n    case LOGIN_REQUEST_SUCCESS:\n      return _objectSpread({}, state, {\n        user: action.payload.user,\n        isLoading: false,\n        error: null\n      });\n\n    case LOGIN_REQUEST_FAILURE:\n      return _objectSpread({}, state, {\n        isLoading: false,\n        user: null,\n        error: action.payload.error\n      });\n\n    case LOGOUT:\n      return _objectSpread({}, state, {\n        isLoading: false,\n        user: null,\n        error: null\n      });\n\n    default:\n      return state;\n  }\n});","map":{"version":3,"sources":["/Users/chrisfu/openapi.portal/ui/src/reducers/auth.js"],"names":["jwt_decode","LOGOUT","LOGIN_REQUESTED","LOGIN_REQUEST_SUCCESS","LOGIN_REQUEST_FAILURE","loadUserProfile","token","localStorage","getItem","user","decoded","now","Date","getTime","exp","err","initialState","isLoading","error","initializeState","Object","assign","state","action","type","payload"],"mappings":";;;;;;AAAA,OAAOA,UAAP,MAAuB,YAAvB;AAEA,SACEC,MADF,EAEEC,eAFF,EAGEC,qBAHF,EAIEC,qBAJF,QAKO,uBALP;;AAOA,SAASC,eAAT,GAA2B;AACzB;AACA,MAAI;AACA,QAAMC,KAAK,GAAGC,YAAY,CAACC,OAAb,CAAqB,YAArB,CAAd;AACA,QAAMC,IAAI,GAAGF,YAAY,CAACC,OAAb,CAAqB,WAArB,CAAb;AAEA,QAAIF,KAAK,IAAI,IAAT,IAAiBG,IAAI,IAAI,IAA7B,EAAmC,OAAO,IAAP;AAEnC,QAAMC,OAAO,GAAGV,UAAU,CAACM,KAAD,CAA1B;AACA,QAAMK,GAAG,GAAG,IAAIC,IAAJ,GAAWC,OAAX,KAAuB,IAAnC,CAPA,CAOyC;AACzC;AACA;AACA;;AACA,QAAIF,GAAG,GAAGD,OAAO,CAACI,GAAlB,EAAuB;AACnB,aAAO,IAAP;AACH,KAFD,MAGK;AACH,aAAOL,IAAP;AACD;AACJ,GAjBD,CAiBE,OAAOM,GAAP,EAAY;AACV,WAAO,IAAP;AACH;AACF;;AAED,IAAMC,YAAY,GAAG;AACnBP,EAAAA,IAAI,EAAE,IADa;AAEnBQ,EAAAA,SAAS,EAAE,KAFQ;AAGnBC,EAAAA,KAAK,EAAE;AAHY,CAArB;;AAQA,SAASC,eAAT,GAA2B;AACzB,MAAMV,IAAI,GAAGJ,eAAe,EAA5B;;AACA,MAAI,CAACI,IAAL,EAAW;AACP,WAAOO,YAAP;AACH;;AAED,SAAOI,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBL,YAAlB,EAAgC;AACnCP,IAAAA,IAAI,EAAEA;AAD6B,GAAhC,CAAP;AAGD;;AAED,gBAAe,YAAuC;AAAA,MAAtCa,KAAsC,uEAA9BH,eAAe,EAAe;AAAA,MAAXI,MAAW;;AACpD,UAAQA,MAAM,CAACC,IAAf;AACE,SAAKtB,eAAL;AACE,+BACKoB,KADL;AAEEb,QAAAA,IAAI,EAAE,IAFR;AAGEQ,QAAAA,SAAS,EAAE,IAHb;AAIEC,QAAAA,KAAK,EAAE;AAJT;;AAOF,SAAKf,qBAAL;AACE,+BACKmB,KADL;AAEEb,QAAAA,IAAI,EAAEc,MAAM,CAACE,OAAP,CAAehB,IAFvB;AAGEQ,QAAAA,SAAS,EAAE,KAHb;AAIEC,QAAAA,KAAK,EAAE;AAJT;;AAOF,SAAKd,qBAAL;AACE,+BACKkB,KADL;AAEEL,QAAAA,SAAS,EAAE,KAFb;AAGER,QAAAA,IAAI,EAAE,IAHR;AAIES,QAAAA,KAAK,EAAEK,MAAM,CAACE,OAAP,CAAeP;AAJxB;;AAOF,SAAKjB,MAAL;AACE,+BACKqB,KADL;AAEEL,QAAAA,SAAS,EAAE,KAFb;AAGER,QAAAA,IAAI,EAAE,IAHR;AAIES,QAAAA,KAAK,EAAE;AAJT;;AAOF;AACE,aAAOI,KAAP;AAlCJ;AAoCD,CArCD","sourcesContent":["import jwt_decode from 'jwt-decode';\n\nimport {\n  LOGOUT,\n  LOGIN_REQUESTED,\n  LOGIN_REQUEST_SUCCESS,\n  LOGIN_REQUEST_FAILURE\n} from '../actions/apiActions';\n\nfunction loadUserProfile() {\n  // check if the user has previously logged in. \n  try {\n      const token = localStorage.getItem(\"auth-token\");\n      const user = localStorage.getItem(\"auth-user\");\n\n      if (token == null || user == null) return null; \n\n      const decoded = jwt_decode(token);\n      const now = new Date().getTime() / 1000; // Date().getTime() returns\n      // milliseconds.\n      // So divide by 1000 to get\n      // seconds\n      if (now > decoded.exp) {\n          return null;\n      }\n      else {\n        return user;\n      }\n  } catch (err) {\n      return null;\n  }\n}\n\nconst initialState = {\n  user: null,\n  isLoading: false,\n  error: null\n}\n\n\n\nfunction initializeState() {\n  const user = loadUserProfile();\n  if (!user) {\n      return initialState;\n  }\n\n  return Object.assign({}, initialState, {\n      user: user,\n  });\n}\n\nexport default (state = initializeState(), action) => {\n  switch (action.type) {\n    case LOGIN_REQUESTED:\n      return {\n        ...state,\n        user: null,\n        isLoading: true,\n        error: null,\n      }\n\n    case LOGIN_REQUEST_SUCCESS:\n      return {\n        ...state,\n        user: action.payload.user,\n        isLoading: false,\n        error: null,\n      }\n\n    case LOGIN_REQUEST_FAILURE:\n      return {\n        ...state,\n        isLoading: false,\n        user: null,\n        error: action.payload.error,\n      }\n\n    case LOGOUT:\n      return {\n        ...state,\n        isLoading: false,\n        user: null,\n        error: null,\n      }\n      \n    default:\n      return state\n  }\n}\n"]},"metadata":{},"sourceType":"module"}